<!-- Settings Modal -->
<div id="settingsModal" class="modal">
    <div class="modal-content settings-container">

        <!-- Main Settings View -->
        <div id="mainSettingsView" class="settings-view active">
            <div class="modal-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>

            <div class="modal-body">
                <!-- AI Provider Section -->
                <div class="settings-section">
                    <h3>ü§ñ AI Provider</h3>
                    <div class="form-group">
                        <label>Provider</label>
                        <select id="modelProvider" onchange="onProviderChange()">
                            <option value="claude">Claude (Anthropic)</option>
                            <option value="openai">OpenAI (ChatGPT)</option>
                            <option value="oci-openai">OCI OpenAI (Oracle Cloud)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Model Name (Optional)</label>
                        <input type="text" id="modelName" placeholder="Leave empty for default">
                        <small class="hint">Examples: claude-3-5-sonnet-20241022, gpt-4, cohere.command-r-plus</small>
                    </div>

                    <!-- Provider-specific API Keys -->
                    <div class="form-group" id="anthropicKeyGroup">
                        <label>Anthropic API Key <span class="required">*</span></label>
                        <input type="password" id="anthropicKey" placeholder="sk-ant-...">
                    </div>

                    <div class="form-group" id="openaiKeyGroup" style="display: none;">
                        <label>OpenAI API Key <span class="required">*</span></label>
                        <input type="password" id="openaiKey" placeholder="sk-...">
                    </div>

                    <div id="ociOpenAIGroup" style="display: none;">
                        <div class="form-group">
                            <label>OCI Compartment ID <span class="required">*</span></label>
                            <input type="text" id="ociCompartmentId" placeholder="ocid1.compartment.oc1..xxx">
                        </div>
                        <div class="form-group">
                            <label>OCI Endpoint URL <span class="required">*</span></label>
                            <input type="text" id="ociEndpoint" placeholder="https://inference.generativeai.us-chicago-1.oci.oraclecloud.com">
                        </div>
                        <div class="form-group">
                            <label>OCI Config Path (Optional)</label>
                            <input type="text" id="ociConfigPath" placeholder="~/.oci/config (default)">
                        </div>
                        <div class="form-group">
                            <label>OCI Profile (Optional)</label>
                            <input type="text" id="ociProfile" placeholder="DEFAULT (default)">
                        </div>
                    </div>

                    <div class="form-group">
                        <button class="btn-test" onclick="testConnection()">üîå Test Connection</button>
                        <div id="testConnectionResult" class="test-result"></div>
                    </div>
                </div>

                <hr class="settings-divider">

                <!-- MCP Servers Section -->
                <div class="settings-section">
                    <h3>üîå MCP Servers</h3>
                    <p class="section-description">
                        Enable and configure Model Context Protocol servers to extend AI capabilities.
                    </p>

                    <!-- Atlassian MCP -->
                    <div class="mcp-server-card">
                        <div class="mcp-server-header">
                            <div class="mcp-server-info">
                                <div class="mcp-server-icon">üìã</div>
                                <div>
                                    <h4>Atlassian MCP</h4>
                                    <p class="mcp-server-desc">Access Jira and Confluence</p>
                                </div>
                            </div>
                            <div class="mcp-server-actions">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="atlassianMcpEnabled" checked disabled>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn-configure" onclick="openAtlassianMcpSettings()">
                                    Configure ‚Üí
                                </button>
                            </div>
                        </div>
                        <div class="mcp-server-status">
                            <span class="status-badge required">Required</span>
                            <span class="status-text">10 tools available</span>
                        </div>
                    </div>

                    <!-- Oracle Cloud MCP -->
                    <div class="mcp-server-card">
                        <div class="mcp-server-header">
                            <div class="mcp-server-info">
                                <div class="mcp-server-icon">‚òÅÔ∏è</div>
                                <div>
                                    <h4>Oracle Cloud MCP</h4>
                                    <p class="mcp-server-desc">Manage OCI resources</p>
                                </div>
                            </div>
                            <div class="mcp-server-actions">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="ociMcpEnabled" onchange="onOciMcpToggle()">
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn-configure" onclick="openOciMcpSettings()" id="ociMcpConfigureBtn" disabled>
                                    Configure ‚Üí
                                </button>
                            </div>
                        </div>
                        <div class="mcp-server-status">
                            <span class="status-badge optional">Optional</span>
                            <span class="status-text">10 tools available</span>
                        </div>
                    </div>

                    <!-- Code Repository MCP -->
                    <div class="mcp-server-card">
                        <div class="mcp-server-header">
                            <div class="mcp-server-info">
                                <div class="mcp-server-icon">üìÅ</div>
                                <div>
                                    <h4>Code Repository MCP</h4>
                                    <p class="mcp-server-desc">Access local code repositories</p>
                                </div>
                            </div>
                            <div class="mcp-server-actions">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="codeRepoMcpEnabled" checked disabled>
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn-configure" onclick="openCodeRepoSettings()">
                                    Configure ‚Üí
                                </button>
                            </div>
                        </div>
                        <div class="mcp-server-status">
                            <span class="status-badge required">Built-in</span>
                            <span class="status-text">Filesystem tools + Skills</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeSettings()">Cancel</button>
                <button class="btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>

        <!-- Atlassian MCP Settings View -->
        <div id="atlassianMcpView" class="settings-view">
            <div class="modal-header">
                <button class="back-btn" onclick="backToMainSettings()">‚Üê Back</button>
                <h2>üìã Atlassian MCP Configuration</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>

            <div class="modal-body">
                <div class="settings-section">
                    <h3>Jira Configuration</h3>
                    <div class="form-group">
                        <label>Jira URL <span class="required">*</span></label>
                        <input type="text" id="jiraUrl" placeholder="https://jira.yourcompany.com">
                        <small class="hint">Your Jira instance URL (cloud or self-hosted)</small>
                    </div>
                    <div class="form-group">
                        <label>Jira Username <span class="required">*</span></label>
                        <input type="text" id="jiraUsername" placeholder="your.email@company.com">
                        <small class="hint">Usually your email address</small>
                    </div>
                    <div class="form-group">
                        <label>Jira API Token <span class="required">*</span></label>
                        <input type="password" id="jiraToken">
                        <small class="hint">Personal Access Token from Jira</small>
                    </div>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Confluence Configuration</h3>
                    <div class="form-group">
                        <label>Confluence URL <span class="required">*</span></label>
                        <input type="text" id="confluenceUrl" placeholder="https://confluence.yourcompany.com">
                        <small class="hint">Your Confluence instance URL</small>
                    </div>
                    <div class="form-group">
                        <label>Confluence Username <span class="required">*</span></label>
                        <input type="text" id="confluenceUsername" placeholder="your.email@company.com">
                        <small class="hint">Usually same as Jira username</small>
                    </div>
                    <div class="form-group">
                        <label>Confluence API Token <span class="required">*</span></label>
                        <input type="password" id="confluenceToken">
                        <small class="hint">Personal Access Token from Confluence</small>
                    </div>
                    <div class="form-group">
                        <label>Confluence Space Key (Optional)</label>
                        <input type="text" id="confluenceSpace" placeholder="TEAM">
                        <small class="hint">Default space to search in</small>
                    </div>
                </div>

                <div class="info-box">
                    <strong>üìò How to get API tokens:</strong>
                    <ul>
                        <li><strong>Self-hosted:</strong> Profile ‚Üí Personal Access Tokens</li>
                        <li><strong>Cloud:</strong> <a href="https://id.atlassian.com/manage-profile/security/api-tokens" target="_blank">Atlassian API Tokens</a></li>
                    </ul>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Test Connection</h3>
                    <div class="form-group">
                        <button class="btn-test" onclick="testAtlassianMcpConnection()">üîå Test Atlassian Connection</button>
                        <div id="atlassianMcpTestResult" class="test-result"></div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="backToMainSettings()">‚Üê Back</button>
                <button class="btn-primary" onclick="saveAtlassianMcpSettings()">Save Configuration</button>
            </div>
        </div>

        <!-- Oracle Cloud MCP Settings View -->
        <div id="ociMcpView" class="settings-view">
            <div class="modal-header">
                <button class="back-btn" onclick="backToMainSettings()">‚Üê Back</button>
                <h2>‚òÅÔ∏è Oracle Cloud MCP Configuration</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>

            <div class="modal-body">
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Session Token Required</strong>
                    <p>
                        Oracle Cloud MCP uses ONLY session token authentication for security.
                        Before configuring, create a session token:
                    </p>
                    <code>oci session authenticate --profile-name DEFAULT --region us-phoenix-1</code>
                </div>

                <div class="settings-section">
                    <h3>OCI Configuration</h3>
                    <div class="form-group">
                        <label>OCI Region <span class="required">*</span></label>
                        <input type="text" id="ociMcpRegion" placeholder="us-phoenix-1">
                        <small class="hint">Examples: us-phoenix-1, us-ashburn-1, eu-frankfurt-1</small>
                    </div>
                    <div class="form-group">
                        <label>OCI Compartment ID <span class="required">*</span></label>
                        <input type="text" id="ociMcpCompartmentId" placeholder="ocid1.compartment.oc1..xxx">
                        <small class="hint">Compartment where your resources are located</small>
                    </div>
                    <div class="form-group">
                        <label>OCI Tenancy ID <span class="required">*</span></label>
                        <input type="text" id="ociMcpTenancyId" placeholder="ocid1.tenancy.oc1..xxx">
                        <small class="hint">Your OCI tenancy OCID</small>
                    </div>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Advanced Options</h3>
                    <div class="form-group">
                        <label>OCI Config Path (Optional)</label>
                        <input type="text" id="ociMcpConfigPath" placeholder="~/.oci/config (default)">
                        <small class="hint">Leave empty to use default ~/.oci/config</small>
                    </div>
                    <div class="form-group">
                        <label>OCI Profile (Optional)</label>
                        <input type="text" id="ociMcpProfile" placeholder="DEFAULT (default)">
                        <small class="hint">Leave empty to use DEFAULT profile</small>
                    </div>
                </div>

                <div class="info-box">
                    <strong>üìò Finding your OCIDs:</strong>
                    <ul>
                        <li><code>oci iam compartment list</code> - List compartments</li>
                        <li><code>oci iam tenancy get</code> - Get tenancy ID</li>
                        <li>Or find them in the OCI Console navigation menu</li>
                    </ul>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Test Connection</h3>
                    <div class="form-group">
                        <button class="btn-test" onclick="testOciMcpConnection()">üîå Test OCI Connection</button>
                        <div id="ociMcpTestResult" class="test-result"></div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="backToMainSettings()">‚Üê Back</button>
                <button class="btn-primary" onclick="saveOciMcpSettings()">Save Configuration</button>
            </div>
        </div>

        <!-- Code Repository MCP Settings View -->
        <div id="codeRepoView" class="settings-view">
            <div class="modal-header">
                <button class="back-btn" onclick="backToMainSettings()">‚Üê Back</button>
                <h2>üìÅ Code Repository Skills</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>

            <div class="modal-body">
                <div class="info-box">
                    <strong>üìò About Repository Skills</strong>
                    <p>
                        Skills tell the AI assistant about your code repositories, including their locations,
                        architecture, and how to work with them. Each skill is a markdown file that provides
                        context to help the AI understand your codebase.
                    </p>
                </div>

                <div class="settings-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>Configured Repository Skills</h3>
                        <button class="btn-primary" onclick="addNewSkill()" style="margin: 0;">
                            + Add Repository
                        </button>
                    </div>

                    <div id="skillsList" class="skills-list">
                        <!-- Skills will be loaded here dynamically -->
                        <div style="text-align: center; padding: 2rem; color: #6b7280;">
                            <p>Loading skills...</p>
                        </div>
                    </div>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Skill File Location</h3>
                    <p class="section-description">
                        Skills are stored in the <code>.claude/skills/</code> directory. Each skill has its own folder
                        containing a <code>SKILL.md</code> file.
                    </p>
                    <div class="info-box">
                        <strong>Example structure:</strong>
                        <pre style="margin-top: 0.5rem; font-size: 0.875rem;">
.claude/skills/
‚îú‚îÄ‚îÄ repo-payment-service/
‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md
‚îú‚îÄ‚îÄ repo-trading-platform/
‚îÇ   ‚îî‚îÄ‚îÄ SKILL.md
‚îî‚îÄ‚îÄ template-technical-design/
    ‚îî‚îÄ‚îÄ SKILL.md</pre>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="backToMainSettings()">‚Üê Back</button>
            </div>
        </div>

        <!-- Add/Edit Skill Modal (Nested within Code Repo View) -->
        <div id="editSkillView" class="settings-view">
            <div class="modal-header">
                <button class="back-btn" onclick="backToCodeRepoSettings()">‚Üê Back to Skills</button>
                <h2 id="editSkillTitle">üìù Add Repository Skill</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>

            <div class="modal-body">
                <div class="settings-section">
                    <h3>Skill Information</h3>
                    <div class="form-group">
                        <label>Skill Name <span class="required">*</span></label>
                        <input type="text" id="skillName" placeholder="repo-my-service">
                        <small class="hint">Lowercase, use hyphens. Example: repo-payment-service, template-runbook</small>
                    </div>
                    <div class="form-group">
                        <label>Description <span class="required">*</span></label>
                        <input type="text" id="skillDescription" placeholder="Payment processing service - handles transactions and refunds">
                        <small class="hint">Brief description of the repository or template</small>
                    </div>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Repository Location</h3>
                    <div class="form-group">
                        <label>Repository Path <span class="required">*</span></label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="text" id="skillRepoPath" placeholder="/Users/yourname/projects/my-service" style="flex: 1;">
                            <button class="btn-secondary" onclick="browseForDirectory()" style="margin: 0; white-space: nowrap;">
                                Browse...
                            </button>
                        </div>
                        <small class="hint">Full path to the repository on your local machine</small>
                    </div>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Additional Instructions (Optional)</h3>
                    <div class="form-group">
                        <label>Architecture Overview</label>
                        <textarea id="skillArchitecture" rows="3" placeholder="Describe the high-level architecture..."></textarea>
                        <small class="hint">What are the main components and how do they work together?</small>
                    </div>
                    <div class="form-group">
                        <label>Key Technologies</label>
                        <input type="text" id="skillTechnologies" placeholder="Node.js, TypeScript, PostgreSQL, Redis">
                        <small class="hint">Comma-separated list of technologies used</small>
                    </div>
                    <div class="form-group">
                        <label>Development Setup</label>
                        <textarea id="skillDevSetup" rows="3" placeholder="How to set up the development environment..."></textarea>
                        <small class="hint">Commands to install dependencies, run locally, etc.</small>
                    </div>
                    <div class="form-group">
                        <label>Special Notes</label>
                        <textarea id="skillNotes" rows="3" placeholder="Any special instructions or gotchas..."></textarea>
                        <small class="hint">Important things the AI should know when working with this repo</small>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="backToCodeRepoSettings()">Cancel</button>
                <button class="btn-primary" onclick="saveSkill()">Save Skill</button>
            </div>
        </div>

    </div>
</div>
