<!-- Settings Modal -->
<div id="settingsModal" class="modal">
    <div class="modal-content settings-container">

        <!-- Main Settings View -->
        <div id="mainSettingsView" class="settings-view active">
            <div class="modal-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>

            <div class="modal-body">
                <!-- AI Provider Section -->
                <div class="settings-section">
                    <h3>ü§ñ AI Provider</h3>
                    <div class="form-group">
                        <label>Provider</label>
                        <select id="modelProvider" onchange="onProviderChange()">
                            <option value="claude">Claude (Anthropic)</option>
                            <option value="openai">OpenAI (ChatGPT)</option>
                            <option value="oci-openai">OCI OpenAI (Oracle Cloud)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Model Name (Optional)</label>
                        <input type="text" id="modelName" placeholder="Default: claude-sonnet-4-5 for Claude">
                        <small class="hint">Examples: claude-sonnet-4-5, gpt-4, cohere.command-r-plus</small>
                    </div>

                    <!-- Provider-specific API Keys -->
                    <div class="form-group" id="anthropicKeyGroup">
                        <label>Anthropic API Key <span class="required">*</span></label>
                        <input type="password" id="anthropicKey" placeholder="sk-ant-...">
                    </div>

                    <div class="form-group" id="openaiKeyGroup" style="display: none;">
                        <label>OpenAI API Key <span class="required">*</span></label>
                        <input type="password" id="openaiKey" placeholder="sk-...">
                    </div>

                    <div id="ociOpenAIGroup" style="display: none;">
                        <div class="form-group">
                            <label>OCI Compartment ID <span class="required">*</span></label>
                            <input type="text" id="ociCompartmentId" placeholder="ocid1.compartment.oc1..xxx">
                        </div>
                        <div class="form-group">
                            <label>OCI Endpoint URL <span class="required">*</span></label>
                            <input type="text" id="ociEndpoint" placeholder="https://inference.generativeai.us-chicago-1.oci.oraclecloud.com">
                        </div>
                        <div class="form-group">
                            <label>OCI Config Path (Optional)</label>
                            <input type="text" id="ociConfigPath" placeholder="~/.oci/config (default)">
                        </div>
                        <div class="form-group">
                            <label>OCI Profile (Optional)</label>
                            <input type="text" id="ociProfile" placeholder="DEFAULT (default)">
                        </div>
                    </div>

                    <div class="form-group">
                        <button class="btn-test" onclick="testConnection()">üîå Test Connection</button>
                        <div id="testConnectionResult" class="test-result"></div>
                    </div>
                </div>

                <hr class="settings-divider">

                <!-- MCP Servers Section -->
                <div class="settings-section">
                    <h3>üîå MCP Servers</h3>
                    <p class="section-description">
                        Enable and configure Model Context Protocol servers to extend AI capabilities.
                    </p>

                    <!-- Atlassian MCP -->
                    <div class="mcp-server-card">
                        <div class="mcp-server-header">
                            <div class="mcp-server-info">
                                <div class="mcp-server-icon">üìã</div>
                                <div>
                                    <h4>Atlassian MCP</h4>
                                    <p class="mcp-server-desc">Access Jira and Confluence</p>
                                </div>
                            </div>
                            <div class="mcp-server-actions">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="atlassianMcpEnabled" onchange="onAtlassianMcpToggle()">
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn-configure" onclick="openAtlassianMcpSettings()" id="atlassianMcpConfigureBtn" disabled>
                                    Configure ‚Üí
                                </button>
                            </div>
                        </div>
                        <div class="mcp-server-status">
                            <span class="status-badge optional">Optional</span>
                            <span class="status-text">10 tools available (disabled by default due to security policy)</span>
                        </div>
                    </div>

                    <!-- Oracle Cloud MCP -->
                    <div class="mcp-server-card">
                        <div class="mcp-server-header">
                            <div class="mcp-server-info">
                                <div class="mcp-server-icon">‚òÅÔ∏è</div>
                                <div>
                                    <h4>Oracle Cloud MCP</h4>
                                    <p class="mcp-server-desc">Manage OCI resources</p>
                                </div>
                            </div>
                            <div class="mcp-server-actions">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="ociMcpEnabled" onchange="onOciMcpToggle()">
                                    <span class="toggle-slider"></span>
                                </label>
                                <button class="btn-configure" onclick="openOciMcpSettings()" id="ociMcpConfigureBtn" disabled>
                                    Configure ‚Üí
                                </button>
                            </div>
                        </div>
                        <div class="mcp-server-status">
                            <span class="status-badge optional">Optional</span>
                            <span class="status-text">10 tools available</span>
                        </div>
                    </div>

                    <!-- Custom MCP Servers -->
                    <div id="customMcpServersContainer">
                        <!-- Custom servers will be dynamically added here -->
                    </div>

                    <!-- Add Custom MCP Server Button -->
                    <div style="margin-top: 16px;">
                        <button class="btn-add-mcp" onclick="openAddCustomMcpServer()">
                            ‚ûï Add Custom MCP Server
                        </button>
                        <p class="section-description" style="margin-top: 8px; font-size: 13px;">
                            Add any MCP-compatible server following the standard MCP protocol
                        </p>
                    </div>
                </div>

                <hr class="settings-divider">

                <!-- Claude Skills Section -->
                <div class="settings-section">
                    <h3>üìò Claude Skills</h3>
                    <p class="section-description">
                        Skills provide context about your code repositories, templates, and workflows. Each skill is a markdown file
                        that helps the AI understand your codebase and work more effectively.
                    </p>

                    <div id="skillsList" class="skills-list" style="margin-top: 16px;">
                        <!-- Skills will be loaded here dynamically -->
                        <div style="text-align: center; padding: 2rem; color: #6b7280;">
                            <p>Loading skills...</p>
                        </div>
                    </div>

                    <!-- Add Skill Button -->
                    <div style="margin-top: 16px;">
                        <button class="btn-add-mcp" onclick="addNewSkill()">
                            ‚ûï Add Skill
                        </button>
                        <p class="section-description" style="margin-top: 8px; font-size: 13px;">
                            Skills are stored in <code>.claude/skills/</code> directory
                        </p>
                    </div>
                </div>

                <hr class="settings-divider">

                <!-- Code Repositories Section -->
                <div class="settings-section">
                    <h3>üìÇ Code Repositories</h3>
                    <p class="section-description">
                        Add local code repositories to make them easily accessible. Repositories are referenced by their path
                        and can include an optional description.
                    </p>

                    <div id="codeReposList" style="margin-top: 16px;">
                        <!-- Code repos will be loaded here dynamically -->
                        <div style="text-align: center; padding: 2rem; color: #6b7280;">
                            <p>Loading repositories...</p>
                        </div>
                    </div>

                    <!-- Add Repo Button -->
                    <div style="margin-top: 16px;">
                        <button class="btn-add-mcp" onclick="addNewCodeRepo()">
                            ‚ûï Add Repository
                        </button>
                        <p class="section-description" style="margin-top: 8px; font-size: 13px;">
                            Add paths to your local code repositories
                        </p>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeSettings()">Cancel</button>
                <button class="btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>

        <!-- Atlassian MCP Settings View -->
        <div id="atlassianMcpView" class="settings-view">
            <div class="modal-header">
                <button class="back-btn" onclick="backToMainSettings()">‚Üê Back</button>
                <h2>üìã Atlassian MCP Configuration</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>

            <div class="modal-body">
                <div class="settings-section">
                    <h3>Jira Configuration</h3>
                    <div class="form-group">
                        <label>Jira URL <span class="required">*</span></label>
                        <input type="text" id="jiraUrl" placeholder="https://jira.yourcompany.com">
                        <small class="hint">Your Jira instance URL (cloud or self-hosted)</small>
                    </div>
                    <div class="form-group">
                        <label>Jira Username <span class="required">*</span></label>
                        <input type="text" id="jiraUsername" placeholder="your.email@company.com">
                        <small class="hint">Usually your email address</small>
                    </div>
                    <div class="form-group">
                        <label>Jira API Token <span class="required">*</span></label>
                        <input type="password" id="jiraToken">
                        <small class="hint">Personal Access Token from Jira</small>
                    </div>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Confluence Configuration</h3>
                    <div class="form-group">
                        <label>Confluence URL <span class="required">*</span></label>
                        <input type="text" id="confluenceUrl" placeholder="https://confluence.yourcompany.com">
                        <small class="hint">Your Confluence instance URL</small>
                    </div>
                    <div class="form-group">
                        <label>Confluence Username <span class="required">*</span></label>
                        <input type="text" id="confluenceUsername" placeholder="your.email@company.com">
                        <small class="hint">Usually same as Jira username</small>
                    </div>
                    <div class="form-group">
                        <label>Confluence API Token <span class="required">*</span></label>
                        <input type="password" id="confluenceToken">
                        <small class="hint">Personal Access Token from Confluence</small>
                    </div>
                    <div class="form-group">
                        <label>Confluence Space Key (Optional)</label>
                        <input type="text" id="confluenceSpace" placeholder="TEAM">
                        <small class="hint">Default space to search in</small>
                    </div>
                </div>

                <div class="info-box">
                    <strong>üìò How to get API tokens:</strong>
                    <ul>
                        <li><strong>Self-hosted:</strong> Profile ‚Üí Personal Access Tokens</li>
                        <li><strong>Cloud:</strong> <a href="https://id.atlassian.com/manage-profile/security/api-tokens" target="_blank">Atlassian API Tokens</a></li>
                    </ul>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Test Connection</h3>
                    <div class="form-group">
                        <button class="btn-test" onclick="testAtlassianMcpConnection()">üîå Test Atlassian Connection</button>
                        <div id="atlassianMcpTestResult" class="test-result"></div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="backToMainSettings()">‚Üê Back</button>
                <button class="btn-primary" onclick="saveAtlassianMcpSettings()">Save Configuration</button>
            </div>
        </div>

        <!-- Oracle Cloud MCP Settings View -->
        <div id="ociMcpView" class="settings-view">
            <div class="modal-header">
                <button class="back-btn" onclick="backToMainSettings()">‚Üê Back</button>
                <h2>‚òÅÔ∏è Oracle Cloud MCP Configuration</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>

            <div class="modal-body">
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Session Token Required</strong>
                    <p>
                        Oracle Cloud MCP uses ONLY session token authentication for security.
                        Before configuring, create a session token:
                    </p>
                    <code>oci session authenticate --profile-name DEFAULT --region us-phoenix-1</code>
                </div>

                <div class="settings-section">
                    <h3>OCI Configuration</h3>
                    <div class="form-group">
                        <label>OCI Region <span class="required">*</span></label>
                        <input type="text" id="ociMcpRegion" placeholder="us-phoenix-1">
                        <small class="hint">Examples: us-phoenix-1, us-ashburn-1, eu-frankfurt-1</small>
                    </div>
                    <div class="form-group">
                        <label>OCI Compartment ID <span class="required">*</span></label>
                        <input type="text" id="ociMcpCompartmentId" placeholder="ocid1.compartment.oc1..xxx">
                        <small class="hint">Compartment where your resources are located</small>
                    </div>
                    <div class="form-group">
                        <label>OCI Tenancy ID <span class="required">*</span></label>
                        <input type="text" id="ociMcpTenancyId" placeholder="ocid1.tenancy.oc1..xxx">
                        <small class="hint">Your OCI tenancy OCID</small>
                    </div>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Advanced Options</h3>
                    <div class="form-group">
                        <label>OCI Config Path (Optional)</label>
                        <input type="text" id="ociMcpConfigPath" placeholder="~/.oci/config (default)">
                        <small class="hint">Leave empty to use default ~/.oci/config</small>
                    </div>
                    <div class="form-group">
                        <label>OCI Profile (Optional)</label>
                        <input type="text" id="ociMcpProfile" placeholder="DEFAULT (default)">
                        <small class="hint">Leave empty to use DEFAULT profile</small>
                    </div>
                </div>

                <div class="info-box">
                    <strong>üìò Finding your OCIDs:</strong>
                    <ul>
                        <li><code>oci iam compartment list</code> - List compartments</li>
                        <li><code>oci iam tenancy get</code> - Get tenancy ID</li>
                        <li>Or find them in the OCI Console navigation menu</li>
                    </ul>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Test Connection</h3>
                    <div class="form-group">
                        <button class="btn-test" onclick="testOciMcpConnection()">üîå Test OCI Connection</button>
                        <div id="ociMcpTestResult" class="test-result"></div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="backToMainSettings()">‚Üê Back</button>
                <button class="btn-primary" onclick="saveOciMcpSettings()">Save Configuration</button>
            </div>
        </div>

        <!-- Add/Edit Skill Modal -->
        <div id="editSkillView" class="settings-view">
            <div class="modal-header">
                <button class="back-btn" onclick="backToMainSettings()">‚Üê Back</button>
                <h2 id="editSkillTitle">üìù Edit Skill</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>

            <div class="modal-body" style="display: flex; flex-direction: column; padding: 0; height: calc(100vh - 200px);">
                <!-- Skill Name Input (only shown for new skills) -->
                <div id="skillNameSection" style="padding: 1.5rem 1.5rem 0 1.5rem; display: none;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Skill Name <span class="required">*</span></label>
                        <input type="text" id="skillName" placeholder="repo-my-service" style="font-family: monospace;">
                        <small class="hint">Lowercase, use hyphens. Example: repo-payment-service, template-runbook</small>
                    </div>
                </div>

                <!-- Info box about skill format -->
                <div style="padding: 1rem 1.5rem 0 1.5rem;">
                    <div class="info-box" style="margin: 0;">
                        <strong>üìò Skill Format:</strong> Skills must start with frontmatter containing a description:
                        <pre style="margin-top: 0.5rem; font-size: 0.75rem; background: rgba(0,0,0,0.05); padding: 0.5rem; border-radius: 4px;">---
description: Brief description here
---

# Your Skill Content Here
...</pre>
                    </div>
                </div>

                <!-- Large Skill Content Editor -->
                <div style="flex: 1; padding: 1rem 1.5rem; display: flex; flex-direction: column; min-height: 0;">
                    <div class="form-group" style="flex: 1; display: flex; flex-direction: column; margin: 0; min-height: 0;">
                        <textarea id="skillContent" placeholder="---
description: Payment processing service - handles transactions and refunds
---

# Payment Service

Repository: /Users/yourname/projects/payment-service

## Overview
This service handles payment processing and refunds.

## Architecture
- API Gateway: Express.js
- Database: PostgreSQL
- Cache: Redis

## Getting Started
npm install
npm run dev

## Notes
..." style="flex: 1; font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace; font-size: 13px; line-height: 1.6; resize: none; min-height: 0;"></textarea>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="backToMainSettings()">Cancel</button>
                <button class="btn-primary" onclick="saveSkill()">Save Skill</button>
            </div>
        </div>

        <!-- Add/Edit Code Repository View -->
        <div id="codeRepoView" class="settings-view">
            <div class="modal-header">
                <button class="back-btn" onclick="backToMainSettings()">‚Üê Back</button>
                <h2 id="codeRepoTitle">üìÇ Add Repository</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>

            <div class="modal-body">
                <div class="settings-section">
                    <div class="form-group">
                        <label>Repository Path <span class="required">*</span></label>
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="repoPath" placeholder="/Users/yourname/projects/my-repo" style="flex: 1; font-family: monospace;">
                            <button class="btn-browse" onclick="browseRepoDirectory()">Browse</button>
                        </div>
                        <small class="hint">Full path to the repository on your local machine</small>
                    </div>

                    <div class="form-group">
                        <label>Description (Optional)</label>
                        <input type="text" id="repoDescription" placeholder="Payment processing service">
                        <small class="hint">Brief description of what this repository contains</small>
                    </div>
                </div>

                <div class="info-box">
                    <strong>üí° Tip:</strong> Add repositories that you frequently work with or reference.
                    The path should point to the root directory of your code repository.
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="backToMainSettings()">Cancel</button>
                <button class="btn-primary" onclick="saveCodeRepo()">Save Repository</button>
            </div>
        </div>

        <!-- Custom MCP Server Configuration View -->
        <div id="customMcpServerView" class="settings-view">
            <div class="modal-header">
                <button class="back-btn" onclick="backToMainSettings()">‚Üê Back</button>
                <h2 id="customMcpServerTitle">üîå Add Custom MCP Server</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>

            <div class="modal-body">
                <div class="settings-section">
                    <h3>Server Information</h3>
                    <div class="form-group">
                        <label>Server Name <span class="required">*</span></label>
                        <input type="text" id="customMcpName" placeholder="My Custom MCP Server">
                        <small class="hint">Display name for this MCP server</small>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" id="customMcpDescription" placeholder="Custom tools for...">
                        <small class="hint">Brief description of what this server provides</small>
                    </div>
                    <div class="form-group">
                        <label>Icon (emoji)</label>
                        <input type="text" id="customMcpIcon" placeholder="üîß" maxlength="2">
                        <small class="hint">Optional emoji icon (e.g., üîß, üì¶, üöÄ)</small>
                    </div>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Server Execution</h3>
                    <div class="form-group">
                        <label>Command <span class="required">*</span></label>
                        <input type="text" id="customMcpCommand" placeholder="node">
                        <small class="hint">Executable command (e.g., node, python, npx)</small>
                    </div>
                    <div class="form-group">
                        <label>Arguments <span class="required">*</span></label>
                        <input type="text" id="customMcpArgs" placeholder="/path/to/server.js or mcp-server-package">
                        <small class="hint">Arguments for the command (path to server script or npm package)</small>
                    </div>
                    <div class="form-group">
                        <label>Working Directory</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="customMcpCwd" placeholder="/path/to/server/directory" style="flex: 1;">
                            <button class="btn-browse" onclick="browseCustomMcpCwd()">Browse</button>
                        </div>
                        <small class="hint">Optional: Directory to run the server from</small>
                    </div>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Environment Variables</h3>
                    <p class="section-description">
                        Optional environment variables to pass to the MCP server (one per line: KEY=value)
                    </p>
                    <div class="form-group">
                        <textarea id="customMcpEnv" rows="4" placeholder="API_KEY=your_api_key_here&#10;BASE_URL=https://api.example.com"></textarea>
                        <small class="hint">Format: KEY=value (one per line)</small>
                    </div>
                </div>

                <hr class="settings-divider">

                <div class="settings-section">
                    <h3>Configuration Examples</h3>
                    <div class="info-box">
                        <strong>Example 1: Node.js MCP Server</strong>
                        <pre style="margin-top: 0.5rem; font-size: 0.875rem;">
Command: node
Arguments: /path/to/my-mcp-server/index.js</pre>
                    </div>
                    <div class="info-box" style="margin-top: 8px;">
                        <strong>Example 2: Python MCP Server</strong>
                        <pre style="margin-top: 0.5rem; font-size: 0.875rem;">
Command: python
Arguments: -m my_mcp_server</pre>
                    </div>
                    <div class="info-box" style="margin-top: 8px;">
                        <strong>Example 3: NPM Package</strong>
                        <pre style="margin-top: 0.5rem; font-size: 0.875rem;">
Command: npx
Arguments: @modelcontextprotocol/server-example</pre>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="backToMainSettings()">Cancel</button>
                <button class="btn-primary" onclick="saveCustomMcpServer()">Save MCP Server</button>
            </div>
        </div>

    </div>
</div>
