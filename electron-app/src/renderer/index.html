<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; img-src 'self' data: blob:; connect-src 'self';">
    <title>Atlassian AI Assistant</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Highlight.js theme for syntax highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">
    <!-- Highlight.js library - Full bundle with all common languages -->
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/highlight.min.js"></script>
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.0.0/marked.min.js"></script>
    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Conversation History Sidebar -->
        <div class="conversation-sidebar" id="conversationSidebar">
            <div class="conversation-sidebar-header">
                <button class="sidebar-toggle-button" id="sidebarToggleButton" onclick="toggleConversationSidebar()" title="Toggle chat history">
                    <span class="toggle-icon">â—€</span>
                </button>
                <button class="new-chat-button" id="newChatButton" onclick="startNewConversation()">
                    <span class="icon">+</span>
                    <span class="text">New Chat</span>
                </button>
            </div>

            <div class="conversations-container" id="conversationsContainer">
                <!-- Dynamically populated by JavaScript -->
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>ğŸ¤– AI Assistant</h2>
            </div>

            <div class="sidebar-content">
                <div class="config-status" id="configStatus">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <span id="statusText">Checking configuration...</span>
                </div>

                <div class="quick-actions">
                    <h3>Quick Actions</h3>
                    <button class="action-btn" onclick="quickAction('sprint')">
                        ğŸ“‹ My Sprint Tasks
                    </button>
                    <button class="action-btn" onclick="quickAction('today')">
                        ğŸ“… Today's Work
                    </button>
                    <button class="action-btn" onclick="quickAction('search')">
                        ğŸ” Search Confluence
                    </button>
                    <button class="action-btn" onclick="quickAction('recent')">
                        ğŸ“„ Recent Pages
                    </button>
                </div>

                <div class="settings-section">
                    <button class="settings-btn" onclick="openSettings()">
                        âš™ï¸ Settings
                    </button>
                    <button class="settings-btn" onclick="clearChat()">
                        ğŸ—‘ï¸ Clear Chat
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="main-content">
            <div class="chat-header">
                <h1>Chat with Your Atlassian Assistant</h1>
                <p>Ask me about your Jira tasks or Confluence documentation</p>
            </div>

            <div class="chat-container" id="chatContainer">
                <div class="welcome-message">
                    <h2>ğŸ‘‹ Welcome!</h2>
                    <p>I can help you with:</p>
                    <ul>
                        <li>ğŸ“‹ Viewing and analyzing your Jira tasks</li>
                        <li>ğŸ” Searching Confluence pages</li>
                        <li>ğŸ“– Reading and summarizing documentation</li>
                        <li>ğŸ’¡ Answering questions about your work</li>
                    </ul>
                    <p class="hint">Try asking: "What are my sprint tasks?" or "Search for API documentation"</p>
                </div>
            </div>

            <div class="input-container">
                <div class="input-wrapper">
                    <textarea
                        id="messageInput"
                        placeholder="Ask me anything about Jira or Confluence..."
                        rows="1"
                    ></textarea>
                    <button id="sendButton" onclick="sendMessage()">
                        <span class="send-icon">â¤</span>
                    </button>
                </div>
                <div class="input-hint">
                    Press Enter to send, Shift+Enter for new line
                </div>
            </div>
        </div>
    </div>

    <!-- Include Settings Modal -->
    <script>
        // Load settings HTML dynamically
        fetch('settings.html')
            .then(response => response.text())
            .then(html => {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                document.body.appendChild(tempDiv.firstElementChild);
            });
    </script>

    <script src="renderer.js"></script>
</body>
</html>
